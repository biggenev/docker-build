pipeline {
    agent any
	
	options {
        buildDiscarder(logRotator(numToKeepStr: '10', artifactNumToKeepStr: '10'))
		timestamps()
		}
    stages {
	    stage ("Docker login"){
		    steps {
			   echo "++docker login++"
			   withCredentials([usernamePassword(credentialsId: 'dockerhub', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]){
			   sh """
			   docker login -u $USERNAME -p $PASSWORD
			   """
			   }
			}
		}
        stage('Create build image') {
            steps {
                echo 'Start'
				dir ('.'){
				sh 'docker build -t biggen/mysite:latest . '
				}
				}
            }
		stage ("docker push"){
		    steps {
			echo "++docker push start++"
			sh """
			docker push biggen/mysite:latest
			"""
			}
		}	
        }
    }

